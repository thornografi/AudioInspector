/* ══════════════════════════════════════════════════════════════════════
   AUDIO TREE v3 - Self-contained tree visualization component
   Dependencies: Global CSS variables from popup.css
   JS: audio-tree.js (measureTreeLabels)
   ══════════════════════════════════════════════════════════════════════ */

.audio-tree {
  font-family: var(--font-mono);
  font-size: 11px;
  line-height: 14px;  /* Tam piksel - subpixel label yuksekligi onleme */
  padding: 12px 0 4px 0;  /* Top: başlıktan uzaklık, Bottom: alt boşluk */
  --tree-color: var(--text-secondary);  /* Çizgi rengi (text-muted'dan bir kademe parlak) */
  --tree-unit: 17px;
  --tree-line: 1px;
  --tree-gap: 3px;  /* Connector→öğe boşluğu */
  --stem-ratio: 1.25;  /* Dikey mesafe çarpanı (padding-top = ratio/2) */
}

.tree-node {
  position: relative;
}

/* Parent node'lar (root dahil) flex layout - block/flex tutarsizligini onler */
.tree-node.has-children {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

.tree-label {
  display: inline-block;
  position: relative;
  color: var(--text-primary);
  font-weight: 500;
  /* Label'i çizgilerden ayır - margin ile GERÇEK gap */
  margin-left: var(--tree-gap);
  height: 14px;  /* line-height ile ayni - flexbox subpixel onleme */
  /* Truncation - dar panelde taşma önleme */
  max-width: 200px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Label text - JS olcumu icin ayri element */
.tree-label-text {
  /* display: inline - varsayilan */
}

/* Param (parantez ici) - farkli stil */
.tree-param {
  color: var(--text-muted);
  font-weight: 400;
}

/* Parent govdesi: label-text ortasindan asagi */
.tree-node.has-children > .tree-label::after {
  content: '';
  position: absolute;
  /* JS tarafından set edilir (measureTreeLabels), fallback kullanılmaz */
  left: var(--stem-left, 50%);
  top: calc(100% + var(--tree-gap));
  /* Border rendering: DPI tutarlılığı için (background yerine) */
  width: 0;
  height: calc(var(--tree-unit) * var(--stem-ratio));
  border-left: var(--tree-line) solid var(--tree-color);
}

/* Children container */
.tree-children {
  position: relative;
  padding-left: var(--tree-unit);
  padding-top: calc(var(--tree-unit) * var(--stem-ratio) / 2 + var(--tree-gap));  /* Ustten bosluk - govde baglantisi icin */
  /* JS tarafından set edilir (measureTreeLabels), fallback kullanılmaz */
  margin-left: var(--parent-center, 40px);
}

/* Dikey cizgi: JavaScript'ten gelen dinamik height */
.tree-children::before {
  content: '';
  position: absolute;
  left: 0;
  top: var(--tree-gap);  /* 3px gap - parent stem ile tutarlı */
  /* JS tarafından set edilir (measureTreeLabels), fallback kullanılmaz */
  height: var(--vertical-line-height, calc(100% - 7px));
  /* Border rendering: DPI tutarlılığı için */
  width: 0;
  border-left: var(--tree-line) solid var(--tree-color);
}

/* Yatay dal: dikey cizgiden child'a (label'in icine girmez) */
.tree-children > .tree-node::before {
  content: '';
  position: absolute;
  left: calc(-1 * var(--tree-unit));
  top: var(--horizontal-line-top, 7px);  /* JS tarafından set edilir, fallback: 14px / 2 = 7px */
  /* Border rendering: DPI tutarlılığı için */
  width: var(--tree-unit);
  height: 0;
  border-top: var(--tree-line) solid var(--tree-color);
}

/* Child node layout - minimum yukseklik ile tutarli dikey cizgiler */
.tree-children > .tree-node {
  min-height: calc(var(--tree-unit) * var(--stem-ratio));
  display: flex;
  align-items: flex-start;
  flex-direction: column;
  /* padding-top kaldirildi - cizgi hesaplamasi JS'te yapiliyor (measureTreeLabels) */
}

/* Varyantlar */
.tree-node.tree-monitor .tree-label { color: var(--text-muted); }
.tree-label.has-tooltip { cursor: default; }

/* ══════════════════════════════════════════════════════════════════════
   TREE TOOLTIP - ::before ile (tree stem ::after ile çakışmayı önler)
   ══════════════════════════════════════════════════════════════════════ */
.tree-tooltip {
  position: relative;
  cursor: default;
}

.tree-tooltip::before {
  content: attr(data-tooltip);
  position: fixed;
  top: var(--tt-top, 0);
  left: var(--tt-left, 0);
  transform: translateX(-100%) translateY(-50%);  /* Sola açılır */
  background: var(--bg-tertiary);
  color: var(--text-primary);
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 10px;
  font-weight: normal;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.15s;
  z-index: 1000;
  border: 1px solid var(--border-primary);
  max-width: calc(100vw - 16px);
  overflow: hidden;
  text-overflow: ellipsis;
}

.tree-tooltip:hover::before {
  opacity: 1;
}

/* Boş tooltip gösterme */
.tree-tooltip:not([data-tooltip])::before,
.tree-tooltip[data-tooltip=""]::before {
  display: none;
}
